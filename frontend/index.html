<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🐍 Python 智能程式診斷平台</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <!-- Markdown 渲染 -->
  <script src="lib/marked.min.js"></script>
  <!-- 程式碼高亮 -->
  <link rel="stylesheet" href="lib/github.min.css">
  <script src="lib/highlight.min.js"></script>
  <script src="lib/python.min.js"></script>

  <!-- Split.js for resizing (本地化，避免被 Brave 阻擋) -->
  <script src="lib/split.min.js"></script>

  <!-- Monaco Editor -->
  <script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>
  <!-- API 配置 -->
  <script src="config.js"></script>
  <!-- 題目管理器 -->
  <script src="questions-manager.js"></script>
</head>

<body class="bg-gradient-to-br from-indigo-50 via-blue-50 to-purple-50 min-h-screen flex flex-col">

  <!-- 頂部導覽列 -->
  <header class="bg-white/90 backdrop-blur border-b border-gray-200 shadow-sm sticky top-0 z-50 flex-none">
    <div class="px-6 py-3 flex items-center justify-between">
      <h1 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center gap-2">
        <span>🐍</span> <span>Python 智能程式診斷平台</span>
      </h1>
      <div class="flex items-center gap-3">
        <span id="backendStatus" class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700 border">檢查中</span>
        <span class="text-xs text-indigo-600 bg-indigo-50 border border-indigo-200 px-2 py-1 rounded-full">🌐 Ngrok
          模式</span>
      </div>
    </div>
  </header>

  <!-- 主體內容 -->
  <main class="flex-1 flex flex-col px-4 py-4 overflow-hidden h-[calc(100vh-60px)]">
    <!-- 題目區塊 -->
    <div id="questionContainer" class="mb-4 flex-none">
      <!-- 題目將由 questions-manager.js 動態生成 -->
      <div class="text-center py-2">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"></div>
        <p class="mt-2 text-sm text-gray-600">正在載入題目...</p>
      </div>
    </div>

    <!-- 主要工作區 (可調整大小) -->
    <div id="main-split" class="flex-1 flex flex-row min-h-0">

      <!-- 左側欄位 (程式碼 + 執行結果) -->
      <div id="left-panel" class="flex flex-col min-h-0 bg-transparent pr-2">

        <!-- 上方：程式碼編輯器 -->
        <div id="editor-panel"
          class="flex flex-col min-h-0 bg-white rounded-2xl border border-gray-200 shadow-lg card-hover mb-2 overflow-hidden">
          <div class="flex items-center justify-between p-3 border-b bg-gray-50 flex-none">
            <h4 class="font-semibold text-gray-800 text-sm">🧑‍💻 程式碼編輯器</h4>
            <div class="flex items-center gap-2">
              <span class="text-xs text-gray-500">Ctrl + Enter 執行</span>
              <button id="runBtn"
                class="flex items-center gap-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-1 rounded shadow transition-colors text-xs">
                ▶️ 執行
              </button>
              <button id="aiCheckBtn"
                class="flex items-center gap-1 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded shadow transition-colors text-xs">
                🎯 評分
              </button>
            </div>
          </div>

          <div id="codeEditor" class="flex-1 w-full min-h-0"></div>
        </div>

        <!-- 下方：執行結果 -->
        <div id="output-panel"
          class="flex flex-col min-h-0 bg-white rounded-2xl border border-gray-200 shadow-lg card-hover overflow-hidden">
          <div class="flex items-center justify-between p-3 border-b bg-gray-50 flex-none">
            <h4 class="font-semibold text-gray-800 text-sm">🖥️ 執行結果</h4>
            <span id="runStatus" class="text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 border">等待中</span>
          </div>
          <div class="terminal text-green-200 p-4 overflow-auto scrollbar-thin border-0 flex-1 font-mono text-sm"
            id="outputBox">
            等待程式執行...
          </div>
        </div>
      </div>

      <!-- 右側欄位 (AI 智能分析) -->
      <div id="right-panel"
        class="flex flex-col min-h-0 bg-white rounded-2xl border border-gray-200 shadow-lg card-hover ml-2 overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b bg-gray-50 flex-none">
          <h4 class="font-semibold text-gray-800">🤖 AI 助手</h4>
          <span id="aiStatus"
            class="text-xs px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200">就緒</span>
        </div>

        <!-- AI 分析容器 -->
        <div class="flex-1 flex flex-col min-h-0 overflow-hidden bg-slate-50">
          <!-- 評分結果區域 -->
          <div id="scoreDisplayArea"
            class="flex-shrink-0 p-3 max-h-[40%] overflow-y-auto border-b border-gray-200 bg-white">
            <div id="noScoreYet" class="py-8 text-center">
              <div class="text-gray-400 text-sm">📊 尚無評分紀錄</div>
            </div>
          </div>

          <!-- 對話機器人區域 -->
          <div class="flex-1 flex flex-col min-h-0 relative">
            <!-- 對話歷史 -->
            <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-3">
              <div class="text-sm text-gray-500 text-center py-4">
                💬 有任何問題都可以問我！
              </div>
            </div>

            <!-- 輸入框 -->
            <div class="flex-shrink-0 border-t border-gray-200 bg-white p-3">
              <div class="flex gap-2">
                <input type="text" id="chatInput" placeholder="輸入問題..."
                  class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                  onkeypress="if(event.key==='Enter') document.getElementById('chatSendBtn').click()" />
                <button id="chatSendBtn"
                  class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg transition-colors text-sm font-medium">
                  發送
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- 學習進度概覽 -->
    <section class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl mt-8">
      <div class="px-4 sm:px-6 py-8 sm:py-10 text-white">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div>
            <h2 class="text-2xl sm:text-3xl font-bold flex items-center gap-3 text-shadow">📊 學習進度</h2>
            <div id="studentNameDisplay" class="text-sm mt-2 opacity-90 flex items-center gap-2">
              <span>👤 學生：</span><span id="studentNameText" class="font-semibold">載入中...</span>
            </div>
          </div>
          <div class="text-sm bg-white/20 px-3 py-1.5 rounded-full border border-white/30">
            ⏱️ 總學習時間：<span id="totalTimeText" class="font-semibold">00:00</span>
          </div>
        </div>

        <div class="bg-white/15 rounded-2xl p-4 sm:p-6 backdrop-blur border border-white/20 shadow-lg mb-6">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm sm:text-base">完成度</div>
            <div class="text-sm"><span id="progressCount" class="font-semibold">0</span>/<span
                id="totalQuestions">10</span> 題目完成</div>
          </div>
          <div class="w-full h-3 bg-white/25 rounded-full overflow-hidden">
            <div id="progressBar" class="h-3 bg-white rounded-full transition-all duration-300" style="width:0%"></div>
          </div>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">總學習時間</div>
            <div id="totalTimeTextCard" class="text-2xl font-bold mt-1">00:00</div>
          </div>
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">程式修改次數</div>
            <div id="codeModCount" class="text-2xl font-bold mt-1">0</div>
          </div>
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">程式執行次數</div>
            <div id="runCount" class="text-2xl font-bold mt-1">0</div>
          </div>
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">平均分數</div>
            <div id="avgScore" class="text-2xl font-bold mt-1">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 提示詞測試區塊（獨立顯示） -->
    <section
      class="bg-gradient-to-br from-purple-50 via-indigo-50 to-blue-50 rounded-2xl p-6 border-2 border-purple-300 shadow-xl mb-8">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h3 class="text-xl font-bold text-purple-800 flex items-center gap-2">
            <span>🧪</span>
            <span>提示詞測試實驗室</span>
          </h3>
          <p class="text-sm text-purple-600 mt-1">即時測試與調整 AI 提示詞，不會儲存到檔案</p>
        </div>
        <div class="flex items-center gap-2">
          <span id="promptTestModeIndicator"
            class="hidden text-xs px-3 py-1.5 rounded-full bg-green-500 text-white font-semibold animate-pulse">
            ✅ 測試模式啟用中
          </span>
        </div>
      </div>

      <!-- 提示詞卡片網格 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
        <!-- 1. analyze_prompt -->
        <div class="bg-white rounded-xl p-5 border-2 border-indigo-200 shadow-md hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-bold text-indigo-800 flex items-center gap-2">
                <span class="text-xl">🎯</span>
                <span>analyze_prompt</span>
              </h4>
              <p class="text-xs text-gray-600 mt-1">程式碼全面分析與評分</p>
            </div>
            <button onclick="editPrompt('analyze')"
              class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg transition-colors font-semibold">
              ✏️ 編輯
            </button>
          </div>
          <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
            <div class="text-xs text-gray-700 font-mono line-clamp-3 whitespace-pre-wrap" id="analyze-preview">
              你是一位專業的 Python 程式教學專家。請全面分析以下學生的程式碼：
              【題目要求】{question}
              【學生程式碼】{code}...
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-xs text-gray-500">
            <span>📍 用於: AI 評分功能</span>
            <span id="analyze-status" class="text-gray-400">使用預設</span>
          </div>
        </div>

        <!-- 2. check_prompt -->
        <div class="bg-white rounded-xl p-5 border-2 border-green-200 shadow-md hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-bold text-green-800 flex items-center gap-2">
                <span class="text-xl">✅</span>
                <span>check_prompt</span>
              </h4>
              <p class="text-xs text-gray-600 mt-1">快速輸出檢查</p>
            </div>
            <button onclick="editPrompt('check')"
              class="text-xs bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition-colors font-semibold">
              ✏️ 編輯
            </button>
          </div>
          <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
            <div class="text-xs text-gray-700 font-mono line-clamp-3 whitespace-pre-wrap" id="check-preview">
              快速檢查這段 Python 程式：
              程式碼：{code}
              實際輸出：{output}...
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-xs text-gray-500">
            <span>📍 用於: 快速檢查</span>
            <span id="check-status" class="text-gray-400">使用預設</span>
          </div>
        </div>

        <!-- 3. suggest_prompt -->
        <div class="bg-white rounded-xl p-5 border-2 border-orange-200 shadow-md hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-bold text-orange-800 flex items-center gap-2">
                <span class="text-xl">💡</span>
                <span>suggest_prompt</span>
              </h4>
              <p class="text-xs text-gray-600 mt-1">引導式學習建議</p>
            </div>
            <button onclick="editPrompt('suggest')"
              class="text-xs bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg transition-colors font-semibold">
              ✏️ 編輯
            </button>
          </div>
          <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
            <div class="text-xs text-gray-700 font-mono line-clamp-3 whitespace-pre-wrap" id="suggest-preview">
              你是一位專業且親切的程式設計老師，使用「引導式學習」教導學生寫程式。
              【教學規則】
              1. 不直接給完整答案...
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-xs text-gray-500">
            <span>📍 用於: 學習建議</span>
            <span id="suggest-status" class="text-gray-400">使用預設</span>
          </div>
        </div>

        <!-- 4. chat_system_prompt -->
        <div class="bg-white rounded-xl p-5 border-2 border-blue-200 shadow-md hover:shadow-lg transition-shadow">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="font-bold text-blue-800 flex items-center gap-2">
                <span class="text-xl">💬</span>
                <span>chat_system_prompt</span>
              </h4>
              <p class="text-xs text-gray-600 mt-1">AI 對話系統</p>
            </div>
            <button onclick="editPrompt('chat')"
              class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-colors font-semibold">
              ✏️ 編輯
            </button>
          </div>
          <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
            <div class="text-xs text-gray-700 font-mono line-clamp-3 whitespace-pre-wrap" id="chat-preview">
              你是一位專業且親切的程式設計老師，使用「引導式學習」教導學生寫程式。
              【教學規則】
              1. 不直接給完整答案...
            </div>
          </div>
          <div class="mt-2 flex items-center justify-between text-xs text-gray-500">
            <span>📍 用於: AI 聊天機器人</span>
            <span id="chat-status" class="text-gray-400">使用預設</span>
          </div>
        </div>
      </div>

      <!-- 編輯器模態框（隱藏） -->
      <div id="promptEditorModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
          <!-- 模態框標題 -->
          <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-5 flex items-center justify-between">
            <div>
              <h3 class="text-xl font-bold flex items-center gap-2">
                <span>✏️</span>
                <span id="modalPromptTitle">編輯提示詞</span>
              </h3>
              <p class="text-sm text-purple-100 mt-1" id="modalPromptDesc">提示詞描述</p>
            </div>
            <button onclick="closePromptEditor()"
              class="text-white hover:text-purple-200 text-3xl leading-none">&times;</button>
          </div>

          <!-- 編輯器內容 -->
          <div class="flex-1 overflow-y-auto p-6">
            <div class="mb-4">
              <div class="flex items-center justify-between mb-2">
                <label class="block text-sm font-semibold text-gray-700">提示詞內容：</label>
                <div class="flex gap-2">
                  <button id="resetPromptBtn"
                    class="text-xs bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded-lg transition-colors">
                    🔄 重置為預設
                  </button>
                  <button id="copyPromptBtn"
                    class="text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg transition-colors">
                    📋 複製
                  </button>
                </div>
              </div>
              <textarea id="promptTextarea"
                class="w-full h-96 px-4 py-3 border-2 border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 font-mono text-sm bg-white resize-none"
                placeholder="在此編輯提示詞內容..."></textarea>
              <div class="flex items-center justify-between mt-2">
                <div class="text-xs text-gray-500">
                  💡 使用 {變數名稱} 插入動態內容（如：{code}、{output}、{question}）
                </div>
                <div class="text-xs text-gray-500">
                  字數：<span id="charCount">0</span>
                </div>
              </div>
            </div>

            <!-- 警告提示 -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
              <div class="flex items-start gap-3">
                <span class="text-yellow-600 text-xl">⚠️</span>
                <div>
                  <p class="text-sm font-semibold text-yellow-800">測試模式說明</p>
                  <ul class="text-xs text-yellow-700 mt-1 space-y-1">
                    <li>• 修改僅儲存在瀏覽器記憶體，重新整理頁面即清除</li>
                    <li>• 下次使用對應功能時會套用自訂提示詞</li>
                    <li>• 若要永久保存，請手動複製到 prompts.json 並重啟伺服器</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- 底部按鈕 -->
          <div class="border-t border-gray-200 p-5 bg-gray-50 flex items-center justify-between">
            <button onclick="closePromptEditor()" class="px-5 py-2 text-gray-700 hover:text-gray-900 font-medium">
              取消
            </button>
            <button id="testPromptBtn"
              class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white px-8 py-2 rounded-lg shadow-lg transition-all font-semibold">
              🚀 啟用測試模式
            </button>
          </div>
        </div>
      </div>

      <!-- 快速操作按鈕 -->
      <div class="flex items-center justify-between bg-white rounded-xl p-4 border-2 border-purple-200">
        <div class="flex items-center gap-3">
          <button onclick="resetAllPrompts()"
            class="text-sm bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors font-semibold">
            🔄 全部重置
          </button>
          <button onclick="exportPrompts()"
            class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors font-semibold">
            💾 匯出設定
          </button>
        </div>
        <div class="text-xs text-gray-500">
          <span class="font-semibold">提示：</span>點擊任一提示詞的「編輯」按鈕開始測試
        </div>
      </div>
    </section>

    <!-- 學習活動統計面板（三欄） -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
      <!-- 1. 學習行為追蹤 -->
      <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">📈 學習行為追蹤</h4>

        <!-- 指標 -->
        <div class="space-y-4">
          <!-- 滑鼠移動次數 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">滑鼠移動次數</span>
              <span id="mouseMoveCount" class="text-indigo-700 font-semibold">0</span>
            </div>
            <div class="w-full h-2 bg-indigo-100 rounded-full overflow-hidden mt-1">
              <div id="mouseMoveBar" class="h-2 bg-indigo-500 rounded-full transition-all duration-300"
                style="width:0%"></div>
            </div>
            <div class="text-xs text-gray-500 mt-1">活躍度：<span id="mouseMoveActive">0%</span></div>
          </div>

          <!-- 點擊次數 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">點擊次數</span>
              <span id="clickCount" class="text-green-700 font-semibold">0</span>
            </div>
            <div class="w-full h-2 bg-green-100 rounded-full overflow-hidden mt-1">
              <div id="clickBar" class="h-2 bg-green-500 rounded-full transition-all duration-300" style="width:0%">
              </div>
            </div>
            <div class="text-xs text-gray-500 mt-1">每分鐘：約 <span id="clickPerMin">0</span> 次</div>
          </div>

          <!-- 鍵盤輸入次數 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">鍵盤輸入次數</span>
              <span id="keyPressCount" class="text-blue-700 font-semibold">0</span>
            </div>
            <div class="w-full h-2 bg-blue-100 rounded-full overflow-hidden mt-1">
              <div id="keyPressBar" class="h-2 bg-blue-500 rounded-full transition-all duration-300" style="width:0%">
              </div>
            </div>
            <div class="text-xs text-gray-500 mt-1">每分鐘：約 <span id="keyPerMin">0</span> 次</div>
          </div>

          <!-- 專注時間 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">專注時間</span>
              <span id="focusTimeText" class="text-purple-700 font-semibold">00:00</span>
            </div>
            <div class="w-full h-2 bg-purple-100 rounded-full overflow-hidden mt-1">
              <div id="focusBar" class="h-2 bg-purple-500 rounded-full transition-all duration-300" style="width:0%">
              </div>
            </div>
            <div class="text-xs text-gray-500 mt-1">當前連續專注：<span id="focusStreakText">0s</span></div>
          </div>
        </div>

        <!-- 底部基本統計 -->
        <div class="grid grid-cols-2 gap-3 mt-5">
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">成功執行</div>
            <div id="successfulRuns" class="text-lg font-bold text-gray-800">0</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">錯誤次數</div>
            <div id="errorCount" class="text-lg font-bold text-gray-800">0</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">程式修改</div>
            <div id="codeModBottom" class="text-lg font-bold text-gray-800">0</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">累計分數</div>
            <div id="totalScoreCount" class="text-lg font-bold text-gray-800">0</div>
          </div>
        </div>
      </div>

      <!-- 2. AI 評分系統 -->
      <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-lg card-hover">
        <h4 class="font-semibold text-gray-800 mb-5 flex items-center gap-2">🏆 AI 評分系統</h4>

        <!-- 總分圓環 -->
        <div class="flex justify-center mb-6">
          <div class="relative">
            <svg height="180" width="180">
              <circle cx="90" cy="90" r="75" stroke="#E5E7EB" stroke-width="14" fill="none" />
              <circle id="scoreRing" class="progress-ring__circle" cx="90" cy="90" r="75" stroke="#6366F1"
                stroke-linecap="round" stroke-width="14" fill="none" stroke-dasharray="471" stroke-dashoffset="471" />
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <div id="mainScore" class="text-5xl font-extrabold text-gray-800">-</div>
                <div class="text-sm text-gray-500 mt-1">總分</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 四個評分項目 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div
            class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-4 border border-indigo-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-indigo-700 font-semibold flex items-center gap-2">
                <span class="text-xl">⏱️</span>
                <span>時間複雜度</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreTimeComplexity" class="text-3xl font-bold text-indigo-800">-</div>
              <div class="text-lg text-indigo-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-indigo-600 mt-1">執行效率評估</div>
          </div>

          <div
            class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-purple-700 font-semibold flex items-center gap-2">
                <span class="text-xl">💾</span>
                <span>空間複雜度</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreSpaceComplexity" class="text-3xl font-bold text-purple-800">-</div>
              <div class="text-lg text-purple-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-purple-600 mt-1">記憶體使用評估</div>
          </div>

          <div
            class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-green-700 font-semibold flex items-center gap-2">
                <span class="text-xl">📖</span>
                <span>程式易讀性</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreReadability" class="text-3xl font-bold text-green-800">-</div>
              <div class="text-lg text-green-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-green-600 mt-1">代碼品質評估</div>
          </div>

          <div
            class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-blue-700 font-semibold flex items-center gap-2">
                <span class="text-xl">🛡️</span>
                <span>程式穩定性</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreStability" class="text-3xl font-bold text-blue-800">-</div>
              <div class="text-lg text-blue-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-blue-600 mt-1">錯誤處理評估</div>
          </div>
        </div>
      </div>

      <!-- 3. 效率統計 -->
      <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">⚡ 效率統計</h4>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">成功執行率</div>
            <div id="successRate" class="text-2xl font-bold text-gray-800">0%</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">平均編程時間</div>
            <div id="avgCodingTime" class="text-2xl font-bold text-gray-800">00:00</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">使用時長</div>
            <div id="sessionDuration" class="text-2xl font-bold text-gray-800">00:00</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">錯誤修正次數</div>
            <div id="fixCount" class="text-2xl font-bold text-gray-800">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- AI 學習弱點分析（頁面底部） -->
    <section class="mt-10">
      <!-- 標題 -->
      <div class="flex items-center justify-between mb-4">
        <h4 class="font-semibold text-gray-800 flex items-center gap-2">🧠 AI 學習弱點分析</h4>
        <span class="text-xs px-3 py-1 rounded-full bg-purple-100 text-purple-700 border border-purple-200">智能分析</span>
      </div>

      <!-- 兩欄佈局 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- 左：弱點識別 -->
        <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
          <div class="font-semibold text-gray-800 mb-2 flex items-center gap-2">🔍 識別到的弱點領域</div>
          <div class="space-y-3">
            <div class="rounded-xl p-4 border bg-red-50 border-red-200">
              <div class="flex items-center justify-between">
                <span class="text-red-700 font-semibold">語法錯誤</span>
                <span id="weakSyntax" class="text-red-700 text-sm">70% 頻率</span>
              </div>
              <div class="w-full h-2 bg-red-100 rounded-full overflow-hidden mt-2">
                <div id="weakSyntaxBar" class="h-2 bg-red-500 rounded-full transition-all duration-300"
                  style="width:70%"></div>
              </div>
            </div>
            <div class="rounded-xl p-4 border bg-yellow-50 border-yellow-200">
              <div class="flex items-center justify-between">
                <span class="text-yellow-700 font-semibold">編碼效率</span>
                <span id="weakSpeed" class="text-yellow-700 text-sm">45% 頻率</span>
              </div>
              <div class="w-full h-2 bg-yellow-100 rounded-full overflow-hidden mt-2">
                <div id="weakSpeedBar" class="h-2 bg-yellow-500 rounded-full transition-all duration-300"
                  style="width:45%"></div>
              </div>
            </div>
            <div class="rounded-xl p-4 border bg-blue-50 border-blue-200">
              <div class="flex items-center justify-between">
                <span class="text-blue-700 font-semibold">變數命名</span>
                <span id="weakNaming" class="text-blue-700 text-sm">30% 頻率</span>
              </div>
              <div class="w-full h-2 bg-blue-100 rounded-full overflow-hidden mt-2">
                <div id="weakNamingBar" class="h-2 bg-blue-500 rounded-full transition-all duration-300"
                  style="width:30%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右：改善建議 -->
        <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
          <div class="font-semibold text-gray-800 mb-2 flex items-center gap-2">👨‍🏫 老師的引導與提示</div>
          <div class="space-y-3">
            <!-- 引導式學習回饋 -->
            <div class="rounded-xl p-4 border bg-green-50 border-green-200">
              <div class="font-semibold text-green-800 mb-1">💬 引導式回饋</div>
              <ul id="actionList" class="list-disc pl-5 text-sm text-green-900 space-y-1">
                <li>先完成輸出題，確保每行輸出一致</li>
                <li>輸入完畢後使用 AI 檢查取得分數</li>
                <li>每次修改後儲存一次，累積進度</li>
              </ul>
            </div>
            <!-- 推薦學習資源 -->
            <div class="rounded-xl p-4 border bg-purple-50 border-purple-200">
              <div class="font-semibold text-purple-800 mb-1">推薦學習資源</div>
              <ul class="list-disc pl-5 text-sm text-purple-900 space-y-1">
                <li><a href="https://docs.python.org/zh-tw/3/tutorial/" target="_blank" rel="noopener noreferrer"
                    class="underline hover:text-purple-700">Python 官方教學</a></li>
                <li><a href="https://www.w3schools.com/python/" target="_blank" rel="noopener noreferrer"
                    class="underline hover:text-purple-700">W3Schools Python</a></li>
                <li><a href="https://realpython.com/" target="_blank" rel="noopener noreferrer"
                    class="underline hover:text-purple-700">Real Python</a></li>
              </ul>
            </div>
            <!-- 進度追蹤 -->
            <div class="rounded-xl p-4 border bg-slate-50 border-slate-200">
              <div class="font-semibold text-slate-800 mb-1">進度追蹤</div>
              <div class="text-sm text-slate-700">下次評估時間：<span id="nextAssessment">--:--</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 學習路徑建議 -->
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-5 border border-white/20 shadow-lg mt-6">
        <div class="text-white font-semibold mb-3 flex items-center gap-2">🗺️ 您的學習路徑建議</div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-white/15 border border-white/30 rounded-xl p-4 text-white">
            <div class="font-semibold mb-1">🌱 當前階段</div>
            <div class="text-sm">基礎語法：print、變數基礎、資料輸出</div>
          </div>
          <div class="bg-white/15 border border-white/30 rounded-xl p-4 text-white">
            <div class="font-semibold mb-1">🌿 下一階段</div>
            <div class="text-sm">變數與資料類型：int、str、list、dict</div>
          </div>
          <div class="bg-white/15 border border-white/30 rounded-xl p-4 text-white">
            <div class="font-semibold mb-1">🌳 進階目標</div>
            <div class="text-sm">流程控制：if、for、while 與函式拆分</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-xs text-gray-500">
    本平台為前端示範：Python 程式執行為模擬解析，非真實執行環境。
  </footer>

  <script src="script.js"></script>
</body>

</html>